# RECOMMENDED: Manifold-Aligned Progressive Training
#
# Key innovations:
# 1. Manifold alignment loss prevents flowing off-manifold
# 2. Progressive training prevents early point attractor collapse
# 3. Balanced regularization maintains flow quality
#
# Expected results:
# - Smooth trajectories through real image space
# - No point attractor collapse
# - Good attribute separation with manifold preservation

model:
  embedding_dim: 512
  num_attributes: 5
  hidden_dim: 256
  projection_radius: 1.0

training:
  num_epochs: 100
  batch_size: 512
  learning_rate: 0.0001
  alpha: 0.12  # Moderate step size

  # Progressive schedule
  warmup_epochs: 20      # Phase 1: Learn identity
  transition_epochs: 50  # Phase 2: Introduce clustering
  # epochs 51-100: Phase 3: Full training

loss:
  # Manifold alignment (NEW - prevents off-manifold flow)
  lambda_manifold: 0.5     # Strong constraint to stay near real embeddings
  manifold_k_neighbors: 5  # Use 5 nearest real embeddings

  # Progressive contrastive loss
  # Will be automatically adjusted by training script:
  # Epochs 1-20:   lambda_contrastive = 0.0
  # Epochs 21-50:  lambda_contrastive = 0.1
  # Epochs 51-100: lambda_contrastive = 0.3
  lambda_contrastive_schedule:
    phase1: 0.0   # No clustering initially
    phase2: 0.1   # Weak clustering
    phase3: 0.3   # Moderate clustering

  # Temperature schedule
  temperature_schedule:
    phase1: 0.5   # Very soft
    phase2: 0.4   # Moderately soft
    phase3: 0.3   # Balanced

  # Identity loss schedule (inverse of contrastive)
  lambda_identity_schedule:
    phase1: 1.0   # Strong manifold constraint
    phase2: 0.5   # Moderate
    phase3: 0.2   # Weaker (let clustering work)

  # Regularization (constant throughout)
  lambda_curl: 0.02
  lambda_div: 0.02

inference:
  num_flow_steps: 10
  step_size: 0.1

ablation:
  use_contrastive: true
  use_curl: true
  use_div: true
  use_label_condition: true
